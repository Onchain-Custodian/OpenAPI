# ONCHAIN CUSTODIAN API DOCUMENTATION

## 1. Introduction

This API document is designed to help developers integrate Onchain Custodian's warm wallet solution with their systems. There are two types of open APIs offered: Query and Withdraw. Developers can create APIs with different permissions according to their own needs, and use these APIs to query information or to perform withdrawal transactions.

## 2. API KEY
In order for developers to deploy any APIs in their system, they must first apply for the API key and other relevant information via the Onchain Custodian platform. The development of APIs shall be carried out according to the details in this document. In case of any questions or suggestions, please reach out to your Onchain Custodian Relationship Manager or our support team at support@oncustodian.com.

**Note**: API Keys have a validity of **90** days. Please create a new API Key and remove the old one before the key expires.

## 3. REST API
REST, short for Representational State Transfer, is currently the most commonly used software architecture. It has a clear structure, is easy to expand, and is being adopted by more and more developers. 

## 4. Standards


**Time Stamp**

Unless otherwise specified, all timestamps returned via API will be in milliseconds, UTC time.

**Example**

1573574713991

**Number**

In order to maintain cross-platform accuracy and data integrity, numbers are returned as strings. It is recommended that developers convert numbers to strings when making API requests, to avoid truncation and precision errors. Integers such as transaction number or ordinal number are returned without any quotation marks.




## 5. Types of API
There are two types of API:

**Public Open API**

Public Open API can be used to get the API server system time. 

Requests can be invoked without authentication.

**Private API**

Private API is used for Onchain Custodian's warm wallet . 

Request must be signed using a standard form of verification.

Private API requires verification using the assigned API key.



## 6.Verification
There are 6 verification factors in total:

-  Generate API Key
-  Initiate API call
-  Signature
-  Timestamp
-  IP Whitelist
-  Server time 

###### 6.1 Generation of API Key

Before initiating any request, the client must create an API Key in Onchain Custodian's platform. Upon creation of an API Key, the client will receive 3 pieces of information: API Key, Secret and Passphrase.

While the API Key and Secret are randomly generated by Onchain Custodian's platform, the Passphrase is provided by the client to ensure security of the API access. Onchain Custodian's platform will store the hash value of the Secret, encrypted by the Passphrase for verification purposes. If the client mishandles or loses the Passphrase, the Custodian platform will not be able to recover it and the Client would need to create new API keys within the platform.

###### 6.2 Initiation of API Request

All REST requests must include the following:

AUTHORIZATION:   ApiKey:request time stamp:signature (colon in between)

CUSTODIAN-ACCESS-PASSPHRASE: This is the password to encrypt secret and is secured by the client.

All requests should contain application / json type content and be valid JSON.

###### 6.3 Signature

The signature string is by applying HMAC SHA256 encrpytion to timestamp + method + API Key + requestPath + queryString + body string (after being converted to a map, the key is spliced after the keys are sorted by ASCII) and secret, output through BASE 64 encoding

Example：

sign=CryptoJS.enc.Base64.Stringify(CryptoJS.HmacSHA256(timestamp + 'GET' +'14db63d7f3614664ad1c71dd134a21dc'+ '/v1/api/account'+"?"+"coinType=ETH", secret))

###### 6.4 Signature Parameter
"Timestamp" is the UTC timezone in Unix time stamp format, accurate to millisecond. Requests that are off by more than 30 seconds (before or after) the timestamp will be considered expired by the system and will be rejected. If you think there is a large deviation between your server and the API server, then we recommend that you to get the server time by querying the API server time

"method": GET/POST(ALL IN CAPITAL LETTERS)

"Requestpath" example: /v1/api/account

"querystring" is the parameter in the URL. 

Example:

page_num=1&page_size=10&coin_type=BTC

"body" is the string of the request party. In the most cases “body" is empty (most of the requests are GET)

#### Example of constructing a request to be signed:

The request "body" needs to sort the parameter names in the order of the ASCII code, concatenate "Key" and "Value" with `=`, and split multiple key-values with `&` to convert them into strings.

For example, if the request `body` is:

```javascript
{
	"mnt_nd":"ZPG",
	"amount":190,
	"to_address":"AUol16ghiT9AtxRDtNeq3ovhWJ5iaY6iyd"
}
```

After conversion it would be：

```text
amount=190&mnt_nd=ZPG&to_address=AUol16ghiT9AtxRDtNeq3ovhWJ5iaY6iyd
```
"secret" is generated the same time as the API key. 

Example:

22582BD0CFF14C41EDBF1AB98506286D

###### 6.5 IP Whitelist


The API must be white listed when it is created. In subsequent API calls, the source IP must be white listed.

###### 6.6 Obtain server time

This is a public open API, so authentication is not required.

HTTP request:

GET /v1/api/general/time

Limits: 20 times / 2 second

Example:

```
{

"timestamp": 1573574713991

}
```

###### 6.7 More examples of How to make API calls
Refer to github link: https://github.com/aixingjuele/custodian-sdk-java


## 7. API LIST

###### 7.1 Account

###### 7.1.1 Query Account Summary

```json
{

    "URL": "/v1/api/account",

    "Method": "GET",

    "Params": {},

    "Response": 
    {
        "code": 0,
        "msg": "SUCCESS",
        "result": 
        [
			{
            "address": "tb1q07r35czmvuhl28r93qgv02h6t030gcheqd34rs",
            "address_name": "Hot-Wallet-16-BTC",
            "coin_unique_name": "BTC",
            "coin_symbol": "BTC",
            "coin_full_name": "Bitcoin",
            "coin_decimal": 8,
            "deposit_allowed": 1,
            "withdrawal_allowed": 1,
            "current_balance": "0.084800000000000000",
            "fee_coin": "BTC",
            "estimated_fee": "0.0001",
            "upper_limit": "10.000000000000000000",
            "lower_limit": "0.010000000000000000"
        }
          ]
   }
}
```

| Parameter  |  Type  |             Description             |
| :--------: | :----: | :------------------------------ |
|   address   | String | wallet address |
|   address_name   |  String   |              wallet address name              |
|   coin_unique_name |  String   | coin name |
|   coin_symbol |  String  |              coin symbol              |
|   coin_full_name |  String  | coin full name |
|   coin_decimal |  String  | precision after decimal point |
|   deposit_allowed |  String  | whether posit is allowed ,0=No,1=Yes |
|   withdrawal_allowed |  String  |whether withdrawal is allowed, 0=No, 1=Yes  |
|   current_balance |  String  |current balance |
|   fee_coin |  String  | coin type of the transaction fee |
|   estimated_fee |  String  | estimated transaction fee |
|   upper_limit |  String  | upper limit |
|   lower_limit |  String  | lower limit |

###### 7.1.2 Query Account Detail

```json
{

    "URL": "/v1/api/account/{coinType}",

    "Method": "GET",

    "Params": {},

    "Response": 
    {
        "code": 0,
        "msg": "SUCCESS",
        "result":
		{
        "address": "tb1q07r35czmvuhl28r93qgv02h6t030gcheqd34rs",
        "address_name": "Hot-Wallet-16-BTC",
        "coin_unique_name": "BTC",
        "coin_symbol": "BTC",
        "coin_full_name": "Bitcoin",
        "coin_decimal": 8,
        "deposit_allowed": 1,
        "withdrawal_allowed": 1,
        "current_balance": "0.084800000000000000",
        "fee_coin": "BTC",
        "estimated_fee": "0.0001",
        "upper_limit": "10.000000000000000000",
        "lower_limit": "0.010000000000000000",
        "limit_per_deal": "1.000000000000000000",
        "day_limit_amount": "1.000000000000000000",
        "hour_limit_amount": "1.000000000000000000"
    }
   }
}
```

| Parameter  |  Type  |             Description             |
| :--------: | :----: | :------------------------------ |
| coin_type | String | coin type(BTC,ETH,USDT-ERC20,USDC,CGT,WTC,REN,FTM,MATIC,XSGD-ERC20,BCH) |
|   limit_per_deal |  String   | transaction limit per transaction |
|   day_limit_amount |  String   |balance of daily transaction limit|
|   hour_limit_amount |  String   | balance of hourly transaction limit |

###### 7.1.3 Query Deposit Address

```json
{

    "URL": "/v1/api/account/deposit-address/{coinType}",

    "Method": "GET",

    "Params": {},

    "Response": 
    {

        "code": 0,

        "msg": "SUCCESS",

        "result":
        {
            "coin_unique_name":"",
            
            "deposit_address":""
        }
   }
}
```
| Parameter  |  Type  |             Description             |
| :--------: | :----: | :------------------------------ |
|   coin_unique_name   | String | coin name |
|   deposit_address   | String | deposit address |


###### 7.1.4 Verify Deposit Address

```json
{

    "URL": "/v1/api/account/verify-deposit-address/{coinType}/{address}",

    "Method": "GET",

    "Params": {},

    "Response": 
    {

        "code": 0,

        "msg": "SUCCESS",

        "result": true
   }
}
```
| Parameter  |  Type  |             Description             |
| :--------: | :----: | :------------------------------ |
|   result   | Boolean | true = success , false = fail |

###### 7.1.5 Query child address information based on parent address

```json
{

    "URL": "/v1/api/account/list-hdaddress",

    "Method": "POST",

    "Params": {
		  "master_address": "0x29ff770a1edaa03736336dc84440e0d42a77ee5c",
		  "page_num": 1,
		  "page_size": 10
		},

    "Response": 
    {
	  "code": 0,
	  "msg": "string",
	  "result": {
		"list": [
		  {
			"address": "string",
			"address_name": "string",
			"coin_decimal": 0,
			"coin_full_name": "string",
			"coin_symbol": "string",
			"coin_unique_name": "string",
			"current_balance": "string",
			"deposit_allowed": 0,
			"estimated_fee": "string",
			"fee_coin": "string", 
			"withdrawal_allowed": 0,
			"lower_limit": "string",
			"upper_limit": "string"
		  }
		],
		"page_num": 0,
		"page_size": 0,
		"pages": 0,
		"total": 0
	  }
	}
}
```

######   Request:
| Parameter  |  Type  |             Description             |
| :--------: | :----: | :------------------------------ |
|   master_address   | String | Parent address |
|   page_num   | String | page number |
|   page_size   | String | page size |

######   Response:
| Parameter  |  Type  |             Description             |
| :--------: | :----: | :------------------------------ |
|   address   | String | child address |
|   address_name   | String | child address name |
|   coin_decimal   | Integer | precision after decimal point |
|   coin_full_name   | String | coin full name |
|   coin_symbol   | String | coin symbol |
|   coin_unique_name   | String |coin name   |
|   current_balance   | String | balance of the child address |
|   deposit_allowed   | String | whether deposit is allowed ,0 = no ,1 = yes |
|   estimated_fee   | String | estimated transaction fee |
|   fee_coin   | String | coin type of transaction fee |
|   withdrawal_allowed   | String | whether withdrawal is allowed, 0=No, 1=Yes |
|   lower_limit   | String | lower limit |
|   upper_limit   | String | upper limit |

###### 7.2 Transaction Information

###### 7.2.1 Query Transaction List

> Default Limit set at: 10

```json
{

    "URL": "/v1/api/list-trans",

    "Method": "POST",

    "Params": {
        "tx_type": "1",
        "tx_id": "123",
        "coin_type": "BTC",
        "page_num":1,
        "page_size":10，
    },

    "Response": 
        {

            "code": 0,

            "msg": "SUCCESS",

            "result":{

                "total":120,

                "records":[
                {
                "wallet_name":"",
                "coin_unique_name":"",
                "coin_full_name":"",
                "coin_decimal":"",
                "address":"",
                "source_address":"",
                "tx_type":"1-withdrawal,2-master address deposit,3-hd address deposit,4-collect transaction",
                "amount":100,
                "tx_id":"",
                "tx_hash":"",
                "tx_status":"",
                "create_time":"",
                "confirm_time":"",
                "fee_coin":"",
                "fee":""
            }
            ]
        }

        }
    

}
```
######   Request:
| Parameter  |  Type  |             Description             |
| :--------: | :----: | :------------------------------ |
|   tx_type   | String | 1=withdraw，2=deposit |
|   coin_type   | String | coin type |
|   tx_id   | String | transaction ID |
|   page_num   | int | page number |
|   page_size   | int | page size |

######   Response:
| Parameter  |  Type  |             Description             |
| :--------: | :----: | :------------------------------ |
|   wallet_name   | String | wallet name |
|   coin_unique_name   | String |coin name   |
|   coin_full_name   | String | coin full name |
|   coin_decimal   | Integer | precision after decimal point |
|   address   | String | wallet address |
|   source_address   | String | from address |
|   tx_type   | String | transaction type（1-withdrawal,2-master address deposit,3-hd address deposit,4-collect transaction） |
|   amount   | String | transaction amount |
|   tx_id   | String | transaction ID |
|   tx_hash   | String | transaction hash |
|   tx_status   | String | transaction status |
|   create_time   | String | transaction creation time |
|   confirm_time   | String | transaction success(fail) time |
|   fee_coin   | String | coin type of transaction fee |
|   fee   | String | transaction fee |

###### 7.2.2 Query Transaction Detail

```json
{

    "URL": "/v1/api/trans/{tx_id}",

    "Method": "GET",

    "Params": {},

    "Response": 
    {
        "code": 0,
        "msg": "SUCCESS",
        "result": 
			 {
					"wallet_name":"",
					"coin_unique_name":"",
					"coin_full_name":"",
					"coin_decimal":"",
					"address":"",
					"source_address":"",
					"tx_type":"1-withdrawal,2-master address deposit,3-hd address deposit,4-collect transaction",
					"amount":100,
					"tx_id":"",
					"tx_hash":"",
					"tx_status":"",
					"create_time":"",
					"confirm_time":"",
					"fee_coin":"",
					"fee":""
				}
    }
}
```

| Parameter  |  Type  |             Description             |
| :--------: | :----: | :------------------------------ |
|   wallet_name   | String | wallet name |
|   coin_unique_name   | String |coin name   |
|   coin_full_name   | String | coin full name |
|   coin_decimal   | Integer | precision after decimal point |
|   address   | String | wallet address |
|   source_address   | String | from address |
|   tx_type   | String | transaction type（1-withdrawal,2-master address deposit,3-hd address deposit,4-collect transaction） |
|   amount   | String | transaction amount |
|   tx_id   | String | transaction ID |
|   tx_hash   | String | transaction hash |
|   tx_status   | String | transaction status |
|   create_time   | String | transaction creation type |
|   confirm_time   | String | transaction success(fail) time |
|   fee_coin   | String | coin type of transaction fee |
|   fee   | String | transaction fee |


###### 7.3 Withdrawal

###### 7.3.1 Submit Withdrawal Application

```json
{

    "URL": "/v1/api/trans/withdrawal",

    "Method": "POST",

    "Params": {
        "request_id": "",
        "coin_type": "",
        "to_address": "",
        "tx_amount":99.99,
        "note":""，
   },

    "Response": {

        "code": 0,

        "msg": "SUCCESS",

        "result": {

            "tx_id":""

        }

    }

}
```


######   Request:
| Parameter  |  Type  |             Description             |
| :--------: | :----: | :------------------------------ |
|   request_id   | String | request ID, no repetition allowed |
|   coin_type   | String | coin type |
|   to_address   | String | deposit address |
|   tx_amount   | String | transaction amount |
|   note   | String | remark |

######   Response:
| Parameter  |  Type  |             Description             |
| :--------: | :----: | :------------------------------ |
|   tx_id   | String | transaction ID |

###### 7.4 Child address management

###### 7.4.1 Child address creation

```json
{

    "URL": "/v1/api/hd-address",

    "Method": "POST",

    "Params": {
	  "address": "0x29ff770a1edaa03736336dc84440e0d42a77ee5c", 
	  "count": 2,
	  "remarks": [
		"hd-name-1",
		"hd-name-2"
	  ]
	},

    "Response": {

        "code": 0,

        "msg": "SUCCESS",

        "result": {

            "0x0797bb11a5bbe3692a042cfa57873a38b21ab96a":"hd-name-1",#return format is address:address name
			"0x1673332f5a8b894e834e1934657c44d2f47443b6":"hd-name-2",

        }

    }

}
```

######   Request:
| Parameter  |  Type  |             Description             |
| :--------: | :----: | :------------------------------ |
|   address   | String | parent address |
|   count   | String | count of child address needs to be created |
|   remarks   | String[] | names of the child address |


######   Response:
| Parameter  |  Type  |             Description             |
| :--------: | :----: | :------------------------------ |
|   body   | map | format address:address name |


###### 7.4.2 Modification of Child Address

```json
{

    "URL": "/v1/api/hd-address",

    "Method": "PUT",

    "Params": {
	  "address": "0x0797bb11a5bbe3692a042cfa57873a38b21ab96a",
	  "remark": "hd-name-6"
	},

    "Response": {

        "code": 0,

        "msg": "SUCCESS"

    }

}
```

######   Request
| Parameter  |  Type  |             Description             |
| :--------: | :----: | :------------------------------ |
|   address   | String | parent address |
|   remark   | String | child address name after modification |

###### 7.5 API Call Back


###### 7.5.1 Transaction Notification API Callback

######{notice-type} is type of notification


```json
{

    "URL": "host:port/{notice-type}",

    "Method": "POST",

    "Params":
			{
			"address": "0x29d912b930c2288a2a54ad0446b3b53dce2718d5",
			"amount": "0.099000000000001000",
			"coinType": "ETH",
			"confirmedBlocks": "6",
			"fee": "0.000999999999999",
			"hash": "0xc24b4b8ecec4de14aed9523591de867fff965517d02d66a3f1d110ef5c4dcbd4",
			"status": "1",
			"txId": "20200103025302304697",
			"txType": "Withdraw" 
			}
    "Response": {
        "code": 0,

        "msg": "SUCCESS"

    }

}
```

######   Request:
| Parameter  |  Type  |             Description             |
| :--------: | :----: | :------------------------------ |
| notice-type | String | notice type: transaction-notice |
|   address   | String | wallet address |
|   amount   | String | transaction amount |
|   coinType   | String | coin type |
|   confirmedBlocks   | String| blocks confirmed |
|   fee   | String | transaction fee |
|   hash   | String | hash on blockchain |
|   status   | String | transaction status :0=pending,1=success,2=fail |
|  txId| String | transaction ID |
|   txType   | String | transaction type: Withdraw、Deposit |


######   Response:
| Parameter  |  Type  |             Description             |
| :--------: | :----: | :------------------------------ |
|   code   | long | receive 0 for notification success. If other return codes are received or there is no return, notification will continue until the number of notifications reaches the maximum |
|   msg   | String | description |

## 8. Limit（apiKey+requestpath）
-  Query API Limit set at: 20 times/2 second 
-  Withdrawal API Limit set at: 10 times/2 second

For further questions or to request change in limits please contract your Onchain Custodian Relationship Manager.


## 9. Error Code


| code  |          Description             |
| :--------: | :------------------------------ |
|   0   |  SUCCESS|
|   106001   |The request parameter error|
|   106002   |  Unauthorized|
|   106003   |  The service is temporarily unavailable|
|   106004   |  Interface Timeout|
|   106005   |  Ip address check error|
|   106006   |  Signature verification error|
|   106008   |  Data encryption error|
|   106009   |  Data decryption error|
|   106011   |  Service call exception|
|   106012   |  Passphrase error|
|   106013   |  Timestamp error|
|   106015   |  ApiKey error|
|   106016   |  The amount is in the wrong format.|
|   106018   |  The hot wallet is frozen|
|   106019   |  The amount of withdrawal is wrong|
|   106020   |  The amount of withdrawal is too long in decimal places|
|   106021   |  The transaction amount exceeds the upper limit of the single pen|
|   106022   |  Authorization format error|
|   106023   |  Address error|
|   106024  |  Address notes are 1-64 in length and only alphanumeric|
|   106025   |  HD address quantity exceeds|
|   106026   |  The frequency of the call exceeded the limit.|
|   106027   |  The request is too fast |
|   106028   |  The Same request received|
|   106029   |  Cointype not support.|




